<!DOCTYPE html>
<html>

	<head>

		<meta charset="URF-8">
		<meta name = "viewport" content= "width = device-width", initial-scale="1">
		<title>'커피탄 리 : 내정보</title>
		{% load static %}

        <link rel="stylesheet" href="{% static 'css/mypage.css' %}">
        <link rel="stylesheet" href="{% static 'css/button.css' %}">
		<link rel="stylesheet" href="{% static 'vendor/bootstrap/css/bootstrap.css' %}">
		<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
		<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
		<script src="https://unpkg.com/gijgo@1.9.11/js/gijgo.min.js" type="text/javascript"></script>
		<link href="https://unpkg.com/gijgo@1.9.11/css/gijgo.min.css" rel="stylesheet" type="text/css" />

	</head>

	<body>
	    <style type="text/css">


            body, html{
                 height: 100%;
                background-repeat: no-repeat;
                font-family: 'Oxygen', sans-serif;
                background-size: cover;
            }



        </style>

        {% include 'nav.html' %}
	<br>

<div class="container-fluid">
    <div class="row">
           <div class="col-sm-2">

            <ul class="nav nav-tabs nav-stacked" style="height: 620px; border-bottom: 0px">
            <h3 style="text-align: center; margin-bottom: 25px">Menu</h3>
              <li class="nav-item active">

                  <a class="nav-link active" data-toggle="tab" href="#Modify" style="color: black; font-size:15px; margin-top: 15px">
                 <i class="fa fa-id-badge fa-lg"></i>&nbsp;&nbsp;프로필 수정</a>

              </li>
              <li class="nav-item">
                <a class="nav-link" data-toggle="tab" href="#Record" style="color: black; font-size:15px">
                 <i class="fa fa-search"></i>&nbsp;&nbsp;검색 기록 조회</a>

              </li>
              <li class="nav-item">
                <a class="nav-link" data-toggle="tab" href="#Dismember" style="color: black; font-size:15px">
                 <i class="fa fa-sign-out fa-lg"></i>&nbsp;&nbsp;회원 탈퇴</a>

              </li>
            </ul>

            </div>

    <div class="col-sm-8 col-sm-offset-1">
        <div class="tab-content">

          <div class="tab-pane fade active in" id="Modify" style="width: 100%; height:568px;">
            <div class="row main">
                <div class="col-sm-8 col-sm-offset-2">
				<h3>회원 정보 수정</h3>

				<hr class="col-sm-12" style="color:white">
					<form class="update_form" method="post" action="{% url 'home:update' %}">
                        {% csrf_token %}

						<div class="form-group">
							<label class="cols-sm-2 control-label">아이디(ID)</label>
							<div class="cols-sm-10">
								<div class="input-group">

									<span>&nbsp;&nbsp;&nbsp;{{user.user}}</span>
								    <input type="hidden" class="form-control" name="id" id="id" value="{{user.user}}"/>
								</div>
							</div>
						</div>


						<div class="form-group">
                            <label for="name" class="cols-sm-2 control-label"><span class=req>*</span>&nbsp;이름(Name)</label>
							<div class="cols-sm-10">
								<div class="input-group">
									<span class="input-group-addon"><i class="fas fa-user fa"></i></span>
									<input type="text" class="form-control" name="name" id="name"  value="{{user.name}}" placeholder="이름을 입력하세요."/>
								</div>
							</div>
						</div>

						<div class="form-group">
							<label for="origin_password" class="cols-sm-2 control-label"><span class=req>*</span>&nbsp;기존 비밀번호(Password)</label>
							<div class="cols-sm-10">
								<div class="input-group">
									<span class="input-group-addon"><i class="fa fa-lock fa-lg" aria-hidden="true"></i></span>
									<input type="password" class="form-control" name="origin_password" id="origin_password" placeholder="현재 비밀번호를 입력하세요"/>
								</div>
							</div>
						</div>

						<div class="form-group">
							<label for="password1" class="cols-sm-2 control-label"><span class=req>*</span>&nbsp;새 비밀번호(Password)</label>
							<div class="cols-sm-10">
								<div class="input-group">
									<span class="input-group-addon"><i class="fa fa-lock fa-lg" aria-hidden="true"></i></span>
									<input type="password" class="form-control" name="password1" id="password1" placeholder="비밀번호를 입력하세요"/>
								</div>
							</div>
						</div>

						<div class="form-group">
							<label for="password2" class="cols-sm-2 control-label"><span class=req>*</span>&nbsp;비밀번호 확인(Confirm Password)</label>
							<div class="cols-sm-10">
								<div class="input-group">
									<span class="input-group-addon"><i class="fa fa-check" aria-hidden="true"></i></span>
									<input type="password" class="form-control" name="password2" id="password2"  placeholder="비밀번호 확인"/>
								</div>
							</div>
						</div>


						<div class="form-group">
						    <div class="col-sm-6 col-sm-offset-3">
							 <input type="submit" class="base_button" value="회원 정보 수정"style="margin-top: 0px; width:250px; margin-left: 20px; font-size: large">
                            </div>
						</div>

					</form>
				</div>
			</div>
         </div>
              <!--수정-->


         <div class="tab-pane fade in" id="Record" style="width: 100%; height:568px;">
            <div class="row">
                <div class="col-sm-8 col-sm-offset-2">
				<h3>검색 기록 조회</h3>
				<hr class="col-sm-12" style="color:white">

				<form>
					<div class="col-sm-4">
						<input type="text" id="datepicker1" width="180" style="background-color: white" readonly/>
					</div>

					<div class="col-sm-1">
						<span style="font-weight: bolder; font-size: 20px;margin-left: 6px;">&nbsp~</span>
					</div>

					<div class="col-sm-4">
						<input type="text" id="datepicker2" width="180" style="background-color: white" readonly/>
					</div>

				</form>
                    <div class="col-sm-3">
                        <input class="base_button" id = "search_button" value="기록 조회" style="margin-top: 0px; font-size:large; width:150px;"; readonly>
					</div>
                    <iframe id="txtArea1" style="display:none"></iframe>
                <script>

                        $('#search_button').click(function() {
                            $('#result_table_body').empty();
                            $.ajax({
                                url:"{% url 'home:search_record' %}",
                                type: 'post',
                                data: {
                                    'date1':$('#datepicker1').val(),
                                    'date2':$('#datepicker2').val()
                                },
                                dataType: 'json',
                                success: function (data) {
                                    i=1;
                                    for (var name in data){
                                        $('#result_table_body')
                                            .append('<tr>'+
                                                '<td>'+i+'</td>'+
                                                '<td>'+data[name].cctv_id_id+'</td>'+
                                                '<td>'+data[name].search_time+'</td>'+
                                                '<td>'+data[name].end_time+'</td>'+ '</tr>')
                                            i++;
                                    }

                                },

                                error: function(request,status,error){
                                    alert("입력값을 확인해 주세요.")
                                }

                            })


                            if($("#result_panel").css("display") == "none"){
                                jQuery('#result_panel').css("display", "block");
                            }
                        });


                        function fnExcelReport()
                        {
                            var tab_text="<table border='2px'><tr bgcolor='#87AFC6'>";
                            var textRange;
                            var j=0;
                            tab = document.getElementById('result_table'); // id of table

                            for(j = 0 ; j < tab.rows.length ; j++)
                            {
                                tab_text=tab_text+tab.rows[j].innerHTML+"</tr>";
                            }

                            tab_text=tab_text+"</table>";
                            tab_text= tab_text.replace(/<A[^>]*>|<\/A>/g, "");
                            tab_text= tab_text.replace(/<img[^>]*>/gi,"");
                            tab_text= tab_text.replace(/<input[^>]*>|<\/input>/gi, "");

                            var ua = window.navigator.userAgent;
                            var msie = ua.indexOf("MSIE ");

                            if (msie > 0 || !!navigator.userAgent.match(/Trident.*rv\:11\./))      // If Internet Explorer
                            {
                                txtArea1.document.open("txt/html","replace");
                                txtArea1.document.write(tab_text);
                                txtArea1.document.close();
                                txtArea1.focus();
                                sa=txtArea1.document.execCommand("SaveAs",true,"Say Thanks to Sumit.xls");
                            }
                            else
                                sa = window.open('data:application/vnd.ms-excel,' + encodeURIComponent(tab_text));

                            return (sa);
                        }

                </script>

				</div>

			</div>

			<div class="col-md-12" id = result_panel style="display: none" >
				<div class="panel panel-primary">
					<div class="panel-heading" style="background-color: #6c757d">
						<h3 class="panel-title">Search Record</h3>
						<div class="pull-right" style="margin-top: -18px;font-size: 15px;">
							<span class="filter" id=filter_button data-toggle="tooltip" title="Toggle table filter" data-container="body" style="cursor: pointer;position: relative;margin-left:5px;">
								<i class="glyphicon glyphicon-filter"></i>
							</span>
						</div>
					</div>
					<div class="panel-body" id = filter_box style="display:none;">
						<input type="text" class="form-control" id="result_table_filter" data-action="filter" data-filters="#result_table" placeholder="cctv id / search time / end time" />
					</div>
                    <div style="width:100%; height:260px; overflow:auto">
                        <table class="table table-hover" id="result_table" >
                            <thead>
                                <tr>
                                    <th>num</th>
                                    <th>cctv id</th>
                                    <th>search time</th>
                                    <th>end time</th>
                                </tr>
                            </thead>
                            <tbody id="result_table_body">

                            </tbody>
                        </table>
                    </div>
				</div>
                <button class="pull-right base_button" id="btnExport" onclick="fnExcelReport();" style="margin-top: 0px; margin-bottom: 0px;"> Export To Excel File </button>
			</div>
        </div>

            <script>
                (function(){
                    'use strict';
                    var $ = jQuery;
                    $.fn.extend({
                        filterTable: function(){
                            return this.each(function(){
                                $(this).on('keyup', function(e){
                                    $('.filterTable_no_results').remove();
                                    var $this = $(this),
                                        search = $this.val().toLowerCase(),
                                        target = $this.attr('data-filters'),
                                        $target = $(target),
                                        $rows = $target.find('tbody tr');

                                    if(search == '') {
                                        $rows.show();
                                    } else {
                                        $rows.each(function(){
                                            var $this = $(this);
                                            $this.text().toLowerCase().indexOf(search) === -1 ? $this.hide() : $this.show();
                                        })
                                        if($target.find('tbody tr:visible').size() === 0) {
                                            var col_count = $target.find('tr').first().find('td').size();
                                            var no_results = $('<tr class="filterTable_no_results"><td colspan="'+col_count+'">No results found</td></tr>')
                                            $target.find('tbody').append(no_results);
                                        }
                                    }
                                });
                            });
                        }
                    });
                    $('[data-action="filter"]').filterTable();
                })(jQuery);

                jQuery('#filter_button').click(function () {
                    if($("#filter_box").css("display") == "none"){
                        jQuery('#filter_box').css("display", "block");
                    } else {
                        jQuery('#filter_box').css("display", "none");
                    }
                });





            </script>
                         <!--검색 기록 조회-->


    <div class="tab-pane fade in" id="Dismember" style="width: 100%; height:568px;">
     <div class="row main">
                <div class="col-sm-8 col-sm-offset-2">
				<h3>회원 탈퇴</h3>
				<hr class="col-sm-12" style="color:white">
					<form class="dismember_form" method="post" action="{% url 'home:dismember' %}">
                        {% csrf_token %}

						<div class="form-group">
							<label for="password" class="cols-sm-2 control-label"><span class=req>*</span>비밀번호(Password)</label>
							<div class="cols-sm-10">
								<div class="input-group">
									<span class="input-group-addon"><i class="fa fa-lock fa-lg" aria-hidden="true"></i></span>
									<input type="password" class="form-control" name="password" id="password"  placeholder="비밀번호를 입력하세요"/>
								</div>
							</div>
						</div>

				        <div class="form-group">
						    <div class="col-sm-6 col-sm-offset-3">
						 <input type="submit" class="base_button" value="회원 탈퇴"style="margin-top: 0px; width:250px; margin-left: 20px; font-size: large">
                            </div>
						</div>

					</form>
				</div>
        </div>
    </div>
                         <!--회원 탈퇴-->
        </div>

                         <!-- 탭 콘텐츠-->

    </div>

    </div>


</div>
<br>

        {% include 'footer.html' %}

        {% if messages %}
            <ul class="messages">
                {% for message in messages %}
                    <script>alert("{{ message }}")</script>
                {% endfor %}
            </ul>
        {% endif %}

       <script>
        $('#datepicker1').datepicker({
            uiLibrary: 'bootstrap'
        });
         $('#datepicker2').datepicker({
            uiLibrary: 'bootstrap'
        });
       </script>

		<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
		<script src="{% static 'vendor/bootstrap/js/bootstrap.js' %}"></script>
	</body>
</html>